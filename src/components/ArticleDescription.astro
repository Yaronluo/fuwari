---
// src/components/ArticleDescription.astro
export interface Props {
    description: string; // æ–‡ç« æè¿°å†…å®¹
}

const { description } = Astro.props;

// å¦‚æœæ²¡æœ‰æè¿°ï¼Œåˆ™ä¸æ¸²æŸ“ä»»ä½•ä¸œè¥¿
if (!description || description.trim() === '') {
    return null;
}

// ğŸ¯ å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨é›¶å®½ç©ºæ ¼ä½œä¸ºå ä½ç¬¦
const placeholder = '\u200B'; // é›¶å®½ç©ºæ ¼ï¼Œçœ‹ä¸è§ä½†å æ®ç©ºé—´
---

<div class="article-description">
    <!--
      ğŸ¯ å…³é”®ä¿®æ”¹ 1: æœåŠ¡ç«¯åªæ¸²æŸ“é›¶å®½ç©ºæ ¼
      è¿™æ ·é¡µé¢æœ‰å†…å®¹ä½†ç”¨æˆ·çœ‹ä¸è§ï¼Œé¿å…å¸ƒå±€è·³åŠ¨
    -->
    <div class="description-content" data-description={description}>
        {placeholder}
    </div>
</div>

<script>
    // ç¡®ä¿è„šæœ¬åœ¨å®¢æˆ·ç«¯è¿è¡Œ
    document.addEventListener('astro:page-load', () => {
        setTimeout(initTyping, 50);
    });

    // é¦–æ¬¡åŠ è½½é¡µé¢æ—¶ä¹Ÿéœ€è¦åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(initTyping, 50);
    });

    function initTyping() {
        const descElement = document.querySelector('.article-description .description-content');

        // å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œæˆ–è€…å·²ç»åˆå§‹åŒ–è¿‡ï¼Œåˆ™é€€å‡º
        if (!descElement || descElement.hasAttribute('data-typed')) {
            return;
        }

        // æ ‡è®°ä¸ºå·²åˆå§‹åŒ–ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ
        descElement.setAttribute('data-typed', 'true');

        const text = descElement.getAttribute('data-description');
        if (!text) return;

        // ğŸ¯ å…³é”®ä¿®æ”¹ 2:
        // å…ˆæ¸…ç©ºé›¶å®½ç©ºæ ¼ï¼Œç„¶åä»ç¬¬ä¸€ä¸ªå­—å¼€å§‹æ‰“
        descElement.textContent = '';
        descElement.classList.remove('typing-complete');

        let index = 0;
        const typeSpeed = 25; // æ‰“å­—é€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰

        function typeWriter() {
            if (index < text.length) {
                descElement.textContent += text.charAt(index);
                index++;
                setTimeout(typeWriter, typeSpeed);
            } else {
                // æ‰“å­—å®Œæˆåï¼Œæ·»åŠ ç±»æ¥éšè—å…‰æ ‡
                descElement.classList.add('typing-complete');
            }
        }

        // ç«‹å³å¼€å§‹æ‰“å­—æ•ˆæœ
        typeWriter();
    }
</script>

<style>
    /* ä½¿ç”¨ Fuwari çš„å…¨å±€å˜é‡æ¥ä¿æŒé£æ ¼ä¸€è‡´ */
    .article-description {
        --desc-text: var(--text-90);
        --desc-border: var(--line-divider);
        --desc-primary: var(--primary);
    }

    .article-description {
        margin: 1.5rem 0 2rem 0;
        padding: 1rem 1.25rem;
        border-left: 4px solid var(--desc-primary);
        background: var(--card-bg);
        border-radius: 0 8px 8px 0;
        position: relative;
    }

    .description-content {
        color: var(--desc-text);
        font-size: 1.05rem;
        line-height: 1.7;
        font-style: italic; /* ä½¿ç”¨æ–œä½“ï¼Œæ›´åƒå¼•è¨€ */
        min-height: 1.7em; /* é˜²æ­¢å…‰æ ‡å¯¼è‡´é«˜åº¦è·³åŠ¨ */
    }

    /* æ‰“å­—æœºå…‰æ ‡æ•ˆæœ */
    .description-content::after {
        content: '|';
        color: var(--desc-primary);
        animation: blink-cursor 1s infinite;
        font-weight: bold;
        font-style: normal; /* å…‰æ ‡ä¿æŒæ­£ä½“ */
    }

    /* æ‰“å­—å®Œæˆåéšè—å…‰æ ‡ */
    .description-content.typing-complete::after {
        display: none;
    }

    /* å…‰æ ‡é—ªçƒåŠ¨ç”» */
    @keyframes blink-cursor {
        0%, 50% {
            opacity: 1;
        }
        51%, 100% {
            opacity: 0;
        }
    }
</style>

